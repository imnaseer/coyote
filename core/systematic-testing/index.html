<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://microsoft.github.io/coyote/core/systematic-testing/">
    <link rel="shortcut icon" href="/coyote/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Systematic testing - Coyote</title>
    <link href="/coyote/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/coyote/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/coyote/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/coyote/css/highlight.css">
    <link href="../../css/main.css" rel="stylesheet">
    <link href="../../css/player-controls.css" rel="stylesheet">
    <link href="../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/coyote/js/jquery-3.2.1.min.js"></script>
    <script src="/coyote/js/bootstrap-3.3.7.min.js"></script>
    <script src="/coyote/js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '/coyote/';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Systematic testing", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="/coyote/js/base.js"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=UA-89203408-1"></script>
      <script src="https://consentdeliveryfd.azurefd.net/mscc/lib/v2/wcp-consent.js"></script>
      <script src="../../assets/js/analytics.js"></script>
      <script src="../../assets/js/plugins.js"></script>
      <script src="../../assets/js/animate_trace.js"></script>
      <script src="../../assets/js/animation.js"></script>
      <script src="../../assets/js/progress_bar.js"></script>
      <script src="../../assets/js/trace_model.js"></script>
      <script src="../../assets/js/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../specifications/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../specifications/" class="btn btn-xs btn-link">
        Program specifications
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../non-determinism/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../non-determinism/" class="btn btn-xs btn-link">
        Program non-determinism
      </a>
    </div>
    
  </div>

      

      <h2 id="systematic-testing">Systematic testing</h2>
<p>Coyote testing works by taking over the <a href="../non-determinism/">non-determinism</a> in a program.
Once it has control over the non-determinism, the Coyote tester will repeatedly run a test case,
each time exercising a different set of non-deterministic choices, offering much better coverage
than using other techniques. This powerful testing ability, however, does require help: you must
mark all sources of non-determinism in a way that Coyote understands. Let&rsquo;s see how this is done.</p>
<p>The first requirement is to use one of Coyote&rsquo;s supported programming models to express the
concurrency. This can be fairly easy to do, but very important because Coyote tester is going to
take over the scheduling of the program. In fact, the tester will complain if it detects concurrency
that is outside its control. Take the simple example that was used to explain concurrency
<a href="../non-determinism/">non-determinism</a>. Notice the code below has replaced the .NET
<code>System.Threading.Tasks.Task</code> type with Coyote&rsquo;s <code>Task</code> type, which is part of Coyote&rsquo;s
<a href="../../programming-models/async/overview/">asynchronous Task programming model</a>, and is controlled
during systematic testing.</p>
<pre><code class="language-c#">// Use the Coyote controlled task type.
using Microsoft.Coyote.Tasks;

// Shared variable x.
int x = 0;

int foo()
{
   // Concurrent operations on x.
   var t1 = Task.Run(() =&gt; { x = 1; });
   var t2 = Task.Run(() =&gt; { x = 2; });

   // Join all.
   Task.WaitAll(t1, t2);
}
</code></pre>
<p>When this method <code>foo</code> now executes as part of a test case, the Coyote tester will understand that
it is spawning two tasks that can run concurrently. The tester will explore different ways of
executing the tasks to systematically cover all possibilities. Coyote provides <a href="../../overview/what-is-coyote/">multiple programming
models</a>. Just remember that whichever programming model you choose,
you must express all the concurrency in that model itself.</p>
<p>Coyote also offers APIs for expressing other forms of non-determinism. The <code>CoyoteRuntime.Random</code>
API, for instance, returns a non-deterministic Boolean value. The exact value is chosen by the
tester. This simple API can be used to build more complex
<a href="https://en.wikipedia.org/wiki/Mock_object">mocks</a> of external dependencies in the system. As an
example, suppose that our code calls into an external service. Either this call returns successfully
and the external service does the work that we requested, or it may timeout, or return an error code
if the external service is unable to perform the work at the time. For testing your code, you will
write a mock for it as follows:</p>
<pre><code class="language-c#">Status CallExternalServiceMock(WorkItem work)
{
   if (CoyoteRuntime.Random())
   {
     // Perform work.
     ...
     // Return success.
     return Status.Success;
   }
   else if (CoyoteRuntime.Random())
   {
     // Return error code.
     return Status.ErrorCode1;
   }
   else if (CoyoteRuntime.Random())
   {
     // Return error code.
     return Status.ErrorCode2;
   }
   else
   {
     // Timeout.
     return Status.Timeout;
   }
}
</code></pre>
<p>When using such a mock, the Coyote tester will control the values that <code>Random</code> returns in a way
that provides good coverage. All these techniques can be put together to write very expressive test
cases. A Coyote test has the power of encoding many different scenarios concisely and leave their
exploration to the automated tester.</p>
<p>Using Coyote has two main components. First, using one of Coyote&rsquo;s programming models to write the
code. Second, designing mocks for external dependencies, capturing the sources of non-determinism
that you want tested in your system. Additionally, Coyote also offers ways of writing
<a href="../specifications/">specifications</a> concisely.</p>
<p>See <a href="../../programming-models/actors/state-machine-demo/">animating state machine demo</a> which
shows the systematic testing process in action on a test application that implements the <a href="https://raft.github.io/">Raft
Consensus Algorithm</a>.</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../specifications/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../specifications/" class="btn btn-xs btn-link">
        Program specifications
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../non-determinism/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../non-determinism/" class="btn btn-xs btn-link">
        Program non-determinism
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">
      <p>
        <a href="https://github.com/microsoft/coyote/edit/master/docs/core/systematic-testing.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>

  <section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">

   </div>
  </div>
</section>
<section class="footer-dark pt-60">
  <div class="container-fluid">
    <div class="row">
      <div class="hidden-xs col-sm-5 col-lg-6">
        <a href="" title="homepage" class="logo-footer">
          <img src="/coyote/assets/images/icon.png" alt="Coyote">
        </a>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Coyote</h4>
          <ul class="list-unstyled">

            <li><a href="/coyote/">Home</a></li>

            <li><a href="/coyote/overview/about">About</a></li>

          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Resources</h4>
          <ul class="list-unstyled">

            <li><a href="/coyote/overview/what-is-coyote">Overview</a></li>

            <li><a href="/coyote/get-started/install">Install</a></li>

            <li><a href="/coyote/get-started/using-coyote">Getting started</a></li>

          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Community</h4>
          <ul class="list-unstyled">

            <li><a href="https://github.com/microsoft/coyote" target="_blank">GitHub</a></li>

            <li><a href="https://gitter.im/microsoft/coyote" target="_blank">Gitter</a></li>

          </ul>
        </nav>
      </div>

    </div>

    <div class="row footnote pt-50 pb-20">
      <div class="col-sm-12">
        <hr>
      </div>
      <div class="col-sm-6">
        <ul class="list-unstyled list-inline footnote-copy">

          <li><a href="https://privacy.microsoft.com/en-us/privacystatement/" target="_blank">Privacy</a></li>

          <li><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/copyright/default.aspx" target="_blank">Terms of Use</a></li>

          <li><a href="https://github.com/microsoft/coyote/blob/main/LICENSE" target="_blank">License</a></li>

          <li><a href="javascript:manageCookies()">Cookies</a></li>

        </ul>
      </div>
      <div class="col-sm-6 text-right footnote-copy">
        <ul class="list-unstyled list-inline">
          <li>Â© 2020 Microsoft</li>
          <li><a href="https://www.microsoft.com/" target="_blank"><img class="img-responsive" src="/coyote/assets/images/microsoft-logo.svg?v=3" alt="Microsoft">&nbsp;</a></li>
        </ul>
      </div>
    </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>